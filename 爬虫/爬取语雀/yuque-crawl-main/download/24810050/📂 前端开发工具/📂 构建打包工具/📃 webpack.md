<a name="e05dce83"></a>
## 简介
webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)，一个前端资源加载/打包工具。它将根据模块的依赖关系进行静态分析，然后将这些模块按照指定的规则生成对应的静态资源。

- [Webpack 官网](https://webpack.js.org/)
- [Webpack 中文网](https://www.webpackjs.com/)
- [Webpack GitHub Pages](https://webpack.github.io/)

<a name="webpack-cli"></a>
## webpack-cli
安装：
```bash
yarn add -D webpack webpack-cli
```

在 `package.json` 中配置：
```json
{
  "scripts": {
    "start": "webpack --config webpack.config.js"
  }
}
```

创建配置文件 `webpack.config.js`, 基本结构为：
```javascript
const path = require('path');

module.exports = {
  entry: ["./src/index.js"],
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  mode: 'production'
};
```

编写 `src/index.js`, 随便写点，执行 `yarn start`，即可看到生成了 `dist/bundle.js`
```bash
$ yarn start
Hash: 18514ec958848df1dd47
Version: webpack 4.39.3
Time: 1524ms
Built at: 2019-08-28 14:10:57
    Asset      Size  Chunks             Chunk Names
bundle.js  70.6 KiB       0  [emitted]  main
Entrypoint main = bundle.js
[0] multi ./src/index.js 28 bytes {0} [built]
[1] ./src/index.js 202 bytes {0} [built]
[3] (webpack)/buildin/global.js 472 bytes {0} [built]
[4] (webpack)/buildin/module.js 497 bytes {0} [built]
    + 1 hidden module
```

<a name="0dfbe902"></a>
### 常用命令
完整的webpack支持的选项包括：
```bash
$ npx webpack -h
Usage: webpack [entries...] [options]
Alternative usage to run commands: webpack [command] [options]

The build tool for modern web applications.

Options:
  -c, --config <value...>                Provide path to a webpack configuration file e.g. ./webpack.config.js.
  --config-name <value...>               Name of the configuration to use.
  -m, --merge                            Merge two or more configurations using 'webpack-merge'.
  --env <value...>                       Environment passed to the configuration when it is a function.
  --progress [value]                     Print compilation progress during build.
  -j, --json [value]                     Prints result as JSON or store it in a file.
  -d, --devtool <value>                  Determine source maps to use.
  --no-devtool                           Do not generate source maps.
  --entry <value...>                     The entry point(s) of your application e.g. ./src/main.js.
  --mode <value>                         Defines the mode to pass to webpack.
  --name <value>                         Name of the configuration. Used when loading multiple configurations.
  -o, --output-path <value>              Output location of the file generated by webpack e.g. ./dist/.
  --stats [value]                        It instructs webpack on how to treat the stats e.g. verbose.
  --no-stats                             Disable stats output.
  -t, --target <value...>                Sets the build target e.g. node.
  -w, --watch                            Watch for files changes.
  --no-watch                             Do not watch for file changes.
  --watch-options-stdin                  Stop watching when stdin stream has ended.
  --no-watch-options-stdin               Do not stop watching when stdin stream has ended.

Global options:
  --color                                Enable colors on console.
  --no-color                             Disable colors on console.
  -v, --version                          Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  -h, --help [verbose]                   Display help for commands and options.

Commands:
  build|bundle|b [entries...] [options]  Run webpack (default command, can be omitted).
  configtest|t [config-path]             Validate a webpack configuration.
  help|h [command] [option]              Display help for commands and options.
  info|i [options]                       Outputs information about your system.
  serve|s [entries...]                   Run the webpack dev server. To see all available options you need to install 'webpack-dev-server'.
  version|v [commands...]                Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  watch|w [entries...] [options]         Run webpack and watch for files changes.

To see list of all supported commands and options run 'webpack --help=verbose'.

Webpack documentation: https://webpack.js.org/.
CLI documentation: https://webpack.js.org/api/cli/.
Made with ♥ by the webpack team.
```
常用命令示例：
```bash
# 打包, 同 webpack --config webpack.config.js, 其中 webpack.config.js 为 webpack 默认使用的配置文件
webpack

# 监听文件变更
webpack --watch
```

<a name="b6453aea"></a>
## 基础配置
<a name="entry"></a>
### entry
entry 指定了输入的文件名称, 可以取以下值：

**字符串**
```javascript
entry: './src/index.js'
```

**数组**
```javascript
entry: ["@babel/polyfill", "./app/js"]
```

**对象**
```javascript
entry: {
  app: './src/index.js',
  print: './src/print.js'
}
```

<a name="output"></a>
### output
output 可以指定输出文件的文件名及路径：
```javascript
output: {
  filename: '[name].[hash].bundle.js',
  chunkFilename: '[name].bundle.js',
  path: path.resolve(__dirname, 'dist'),
  publicPath: '/'
}
```

- chunkFilename 在[代码分离](/categories/webpack/separation.html)中会详细讲到
- publicPath 指定静态资源路径

其中的 `[name]`：

- `entry` 为对象时指定的key, 最终输出为 `app.bundle.js` 和 `print.bundle.js`
- `entry` 为字符串或数组时, 最终输出为 `main.bundle.js`

`[hash]` 替换可以用于在文件名中包含一个构建相关(build-specific)的 hash，但是更好的方式是使用 [chunkhash] 替换，在文件名中包含一个 chunk 相关(chunk-specific)的哈希。
```javascript
output: {
  filename: '[name].[chunkhash].js',
  path: path.resolve(__dirname, 'dist')
}
```

<a name="0dd41352"></a>
## 常用配置
<a name="mode"></a>
### mode
指定当前环境, 可选值有: `'production' | 'development' | 'none'`

<a name="6dc7a717"></a>
### 别名
使用 [resolve.alias](https://www.webpackjs.com/configuration/resolve/#resolve-alias) 创建 import 或 require 的别名，来确保模块引入变得更简单。例如，一些位于 src/ 文件夹下的常用模块
```javascript
resolve: {
  alias: {
    Utilities: path.resolve(__dirname, 'src/utilities/'),
    Templates: path.resolve(__dirname, 'src/templates/')
  }
}
```

配置别名前：
```javascript
import Utility from '../../utilities/utility';
```

配置别名后：
```javascript
import Utility from 'Utilities/utility';
```

<a name="22585089"></a>
#### 精准匹配
也可以在给定对象的键后的末尾添加 `$`，以表示精准匹配：
```javascript
alias: {
  xyz$: path.resolve(__dirname, 'path/to/file.js')
}
```

这将产生以下结果：
```javascript
import Test1 from 'xyz'; // 精确匹配，所以 path/to/file.js 被解析和导入
import Test2 from 'xyz/file.js'; // 非精确匹配，触发普通解析
```

<a name="4a63edba"></a>
### 扩展名
自动解析确定的扩展。默认值为：
```javascript
extensions: [".js", ".json"]
```

能够使用户在引入模块时不带扩展名：
```javascript
import File from '../path/to/file'
```

这将依次匹配 `file.js` 和 `file.json`

<a name="29139c2a"></a>
### 文件名
解析目录时要使用的文件名。默认：
```javascript
mainFiles: ["index"]
```

<a name="externals"></a>
### externals
支持的类型: `string` `array` `object` `function` `regex`

**防止**将某些 `import` 的包(package)**打包**到 bundle 中，而是在运行时(runtime)再去从外部获取这些_扩展依赖(external dependencies)_。

例如，从 CDN 引入 [jQuery](https://jquery.com/)，而不是把它打包：

**index.html**
```html
<script
  src="//code.jquery.com/jquery-3.1.0.js"
  integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="
  crossorigin="anonymous">
</script>
```

**webpack.config.js**
```javascript
externals: {
  jquery: 'jQuery'
}
```

这样就剥离了那些不需要改动的依赖模块，换句话，下面展示的代码还可以正常运行：
```javascript
import $ from 'jquery';

$('.my-element').animate(...);
```

<a name="35808e79"></a>
## 参考资料

- [Webpack Configuration](https://www.webpackjs.com/configuration/)

